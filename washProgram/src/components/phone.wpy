<style lang="less">
  .phoneBox{
    display: flex;
    width: 100%;
    height: 100vh;
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1000;
    background-color: RGBA(0,0,0,.6);
    justify-content: center;
    align-items: center;
    button{
      width: 80%;
    }
  }
</style>
<template>
  <view class="phoneBox">
    <button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">手机号授权</button>
  </view>
</template>
<script>
  import wepy from 'wepy'
  import * as appUtils from "appUtils";

  export default class List extends wepy.component {
    data = {

    }

    events = {

    }

    methods = {
      getPhoneNumber(res) {
        let that = this;
        console.log(1234, res);
        console.log('getPhoneNumber', res);
        let encryptedData = res.detail.encryptedData;
        let iv = res.detail.iv;
        appUtils.requestPost(appUtils.api.BIND_MOBILE, {
          encryptedData,
          iv,
          token: appUtils.globalData.token,
        }).then(function(res) {
          console.log('获取手机号', res);
          if(res.data.code === 0){
            console.log('获取手机号成功！');
            wx.setStorageSync("phones", res.data.data);
            that.$emit('phonesActive', res.data.data)
          }else{
            console.log('获取手机号失败');
          }
        });
      }
    }

    onLoad () {
    }
  }
</script>
